name: CD

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "master" branch
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:


jobs:

  build:

    runs-on: ubuntu-latest


    steps:

      - uses: actions/checkout@v3

      - name : docker stop
        uses: appleboy/ssh-action@master
        with:
          host: cspc.me
          username : cocopam
          password: ${{secrets.PASSWORD}}
          script: |
            docker rm -f django-test


      - name : code deploy
        uses : burnett01/rsync-deployments@5.2
        with :
          switches : -avzr --delete
          remote_path : /home/cocopam/workspace/django-actions-test/
          remote_host : cspc.me
          remote_user : cocopam
          remote_key : ${{secrets.SSH_KEY}}


      - name: docker run
        uses: appleboy/ssh-action@master
        with:
          host: cspc.me
          username : cocopam
          password: ${{secrets.PASSWORD}}
          script: |
            sh /home/cocopam/workspace/django-actions-test/deploy.sh
